{"version":3,"file":"router-scroll.js","sources":["../../src/services/router-scroll.js"],"sourcesContent":["import Service, { service } from '@ember/service';\nimport { set, get, action } from '@ember/object';\nimport { typeOf } from '@ember/utils';\nimport { assert } from '@ember/debug';\nimport { getOwner } from '@ember/application';\nimport { scheduleOnce } from '@ember/runloop';\nimport { addListener, removeListener, sendEvent } from '@ember/object/events';\nimport { setupRouter, whenRouteIdle } from '../scheduler.ts';\n\nlet ATTEMPTS = 0;\nconst MAX_ATTEMPTS = 100; // rAF runs every 16ms ideally, so 60x a second\n\nlet requestId;\nlet callbackRequestId;\n\n/**\n * By default, we start checking to see if the document height is >= the last known `y` position\n * we want to scroll to.  This is important for content heavy pages that might try to scrollTo\n * before the content has painted\n *\n * @method tryScrollRecursively\n * @param {Function} fn\n * @param {Object} scrollHash\n * @param {Element} [element]\n * @param {string?} url\n * @void\n */\nfunction tryScrollRecursively(fn, scrollHash, element, url) {\n  let documentHeight;\n  // read DOM outside of rAF\n  if (element) {\n    documentHeight = Math.max(\n      element.scrollHeight,\n      element.offsetHeight,\n      element.clientHeight,\n    );\n  } else {\n    const { body, documentElement: html } = document;\n    documentHeight = Math.max(\n      body.scrollHeight,\n      body.offsetHeight,\n      html.clientHeight,\n      html.scrollHeight,\n      html.offsetHeight,\n    );\n  }\n\n  callbackRequestId = window.requestAnimationFrame(() => {\n    if (url && url.indexOf('#') > -1) {\n      const hashElement = document.getElementById(url.split('#').pop());\n      if (hashElement) {\n        scrollHash = { x: hashElement.offsetLeft, y: hashElement.offsetTop };\n      }\n    }\n    // write DOM (scrollTo causes reflow)\n    if (documentHeight >= scrollHash.y || ATTEMPTS >= MAX_ATTEMPTS) {\n      ATTEMPTS = 0;\n      fn.call(null, scrollHash.x, scrollHash.y);\n    } else {\n      ATTEMPTS++;\n      tryScrollRecursively(fn, scrollHash, element, url);\n    }\n  });\n}\n\n// to prevent scheduleOnce calling multiple times, give it the same ref to this function\nconst CALLBACK = function (transition) {\n  this.updateScrollPosition(transition);\n};\n\nclass RouterScroll extends Service {\n  @service router;\n\n  get isFastBoot() {\n    const fastboot = getOwner(this).lookup('service:fastboot');\n    return fastboot ? fastboot.get('isFastBoot') : false;\n  }\n\n  key;\n  targetElement;\n  scrollElement = 'window';\n  isFirstLoad = true;\n  preserveScrollPosition = false;\n  // ember-app-scheduler properties\n  scrollWhenIdle = false;\n  scrollWhenAfterRender = false;\n\n  constructor() {\n    super(...arguments);\n\n    // https://github.com/ember-app-scheduler/ember-app-scheduler/pull/773\n    setupRouter(this.router);\n  }\n\n  // eslint-disable-next-line ember/classic-decorator-hooks\n  init(...args) {\n    super.init(...args);\n\n    this._loadConfig();\n    set(this, 'scrollMap', {\n      default: {\n        x: 0,\n        y: 0,\n      },\n    });\n\n    addListener(this.router, 'routeWillChange', this._routeWillChange);\n    addListener(this.router, 'routeDidChange', this._routeDidChange);\n  }\n\n  willDestroy() {\n    removeListener(this.router, 'routeWillChange', this._routeWillChange);\n    removeListener(this.router, 'routeDidChange', this._routeDidChange);\n\n    if (requestId) {\n      window.cancelAnimationFrame(requestId);\n    }\n\n    if (callbackRequestId) {\n      window.cancelAnimationFrame(callbackRequestId);\n    }\n\n    super.willDestroy(...arguments);\n  }\n\n  /**\n   * Updates the scroll position\n   * it will be a single transition\n   * @method updateScrollPosition\n   * @param {transition|transition[]} transition If before Ember 3.6, this will be an array of transitions, otherwise\n   */\n  updateScrollPosition(transition) {\n    if (this.isFirstLoad) {\n      this.unsetFirstLoad();\n    }\n\n    let scrollPosition = this.position;\n\n    // If `preserveScrollPosition` was not set on the controller, attempt fallback to `preserveScrollPosition` which was set on the router service.\n    let preserveScrollPosition =\n      (transition.router.currentRouteInfos || []).some(\n        (routeInfo) => routeInfo.route.controller.preserveScrollPosition,\n      ) || this.preserveScrollPosition;\n\n    if (!preserveScrollPosition) {\n      const { scrollElement, targetElement, currentURL } = this;\n\n      if (targetElement || 'window' === scrollElement) {\n        tryScrollRecursively(window.scrollTo, scrollPosition, null, currentURL);\n      } else if ('#' === scrollElement.charAt(0)) {\n        const element = document.getElementById(scrollElement.substring(1));\n\n        if (element) {\n          let fn = (x, y) => {\n            element.scrollLeft = x;\n            element.scrollTop = y;\n          };\n          tryScrollRecursively(fn, scrollPosition, element, currentURL);\n        }\n      }\n    }\n\n    sendEvent(this, 'didScroll', transition);\n  }\n\n  @action\n  _routeWillChange() {\n    if (this.isFastBoot) {\n      return;\n    }\n\n    this.update();\n  }\n\n  @action\n  _routeDidChange(transition) {\n    if (this.isFastBoot) {\n      return;\n    }\n\n    const scrollWhenIdle = this.scrollWhenIdle;\n    const scrollWhenAfterRender = this.scrollWhenAfterRender;\n\n    if (!scrollWhenIdle && !scrollWhenAfterRender) {\n      // out of the option, this happens on the tightest schedule\n      // eslint-disable-next-line ember/no-runloop\n      scheduleOnce('render', this, CALLBACK, transition);\n    } else if (scrollWhenAfterRender && !scrollWhenIdle) {\n      // out of the option, this happens on the second tightest schedule\n      // eslint-disable-next-line ember/no-runloop\n      scheduleOnce('afterRender', this, CALLBACK, transition);\n    } else {\n      whenRouteIdle().then(() => {\n        this.updateScrollPosition(transition);\n      });\n    }\n  }\n\n  unsetFirstLoad() {\n    set(this, 'isFirstLoad', false);\n  }\n\n  update() {\n    if (this.isFastBoot || this.isFirstLoad) {\n      return;\n    }\n\n    const scrollElement = this.scrollElement;\n    const targetElement = this.targetElement;\n    const scrollMap = this.scrollMap;\n    const key = this.key;\n    let x;\n    let y;\n\n    if (targetElement) {\n      let element = document.querySelector(targetElement);\n      if (element) {\n        x = element.offsetLeft;\n        y = element.offsetTop;\n\n        // if we are looking to where to transition to next, we need to set the default to the position\n        // of the targetElement on screen\n        set(scrollMap, 'default', {\n          x,\n          y,\n        });\n      }\n    } else if ('window' === scrollElement) {\n      x = window.scrollX;\n      y = window.scrollY;\n    } else if ('#' === scrollElement.charAt(0)) {\n      let element = document.getElementById(scrollElement.substring(1));\n\n      if (element) {\n        x = element.scrollLeft;\n        y = element.scrollTop;\n      }\n    }\n\n    // only a `key` present after first load\n    if (key && 'number' === typeOf(x) && 'number' === typeOf(y)) {\n      set(scrollMap, key, {\n        x,\n        y,\n      });\n    }\n  }\n\n  _loadConfig() {\n    const config = getOwner(this).resolveRegistration('config:environment');\n\n    if (config && config.routerScroll) {\n      const scrollElement = config.routerScroll.scrollElement;\n      const targetElement = config.routerScroll.targetElement;\n\n      assert(\n        'You defined both scrollElement and targetElement in your config. We currently only support definining one of them',\n        !(scrollElement && targetElement),\n      );\n\n      if ('string' === typeOf(scrollElement)) {\n        set(this, 'scrollElement', scrollElement);\n      }\n\n      if ('string' === typeOf(targetElement)) {\n        set(this, 'targetElement', targetElement);\n      }\n\n      const { scrollWhenIdle = false, scrollWhenAfterRender = false } =\n        config.routerScroll;\n      set(this, 'scrollWhenIdle', scrollWhenIdle);\n      set(this, 'scrollWhenAfterRender', scrollWhenAfterRender);\n    }\n  }\n}\n\nObject.defineProperty(RouterScroll.prototype, 'position', {\n  configurable: true,\n  get() {\n    const scrollMap = this.scrollMap;\n    const stateUuid = window.history.state?.uuid;\n\n    set(this, 'key', stateUuid);\n    const key = this.key || '-1';\n\n    return get(scrollMap, key) || scrollMap.default;\n  },\n});\n\nexport default RouterScroll;\n"],"names":["ATTEMPTS","MAX_ATTEMPTS","callbackRequestId","tryScrollRecursively","fn","scrollHash","element","url","documentHeight","Math","max","scrollHeight","offsetHeight","clientHeight","body","documentElement","html","document","window","requestAnimationFrame","indexOf","hashElement","getElementById","split","pop","x","offsetLeft","y","offsetTop","call","CALLBACK","transition","updateScrollPosition","RouterScroll","Service","g","prototype","service","i","void 0","isFastBoot","fastboot","getOwner","lookup","get","key","targetElement","scrollElement","isFirstLoad","preserveScrollPosition","scrollWhenIdle","scrollWhenAfterRender","constructor","arguments","setupRouter","router","init","args","_loadConfig","set","default","addListener","_routeWillChange","_routeDidChange","willDestroy","removeListener","cancelAnimationFrame","unsetFirstLoad","scrollPosition","position","currentRouteInfos","some","routeInfo","route","controller","currentURL","scrollTo","charAt","substring","scrollLeft","scrollTop","sendEvent","update","n","action","scheduleOnce","whenRouteIdle","then","scrollMap","querySelector","scrollX","scrollY","typeOf","config","resolveRegistration","routerScroll","assert","Object","defineProperty","configurable","stateUuid","history","state","uuid"],"mappings":"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"}